<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Osu! Iraq Leaderboard</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body { font-family: Arial, sans-serif; padding: 20px; max-width: 1200px; margin: auto; }
table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
th { background: #f4f4f4; }
.avatar { width:24px; height:24px; border-radius:50%; vertical-align:middle; margin-right:8px; }
.tab { display:none; }
.tab.active { display:block; }
.tab-buttons button { margin-right:5px; padding:5px 10px; }
.top1 { background: gold; }
.top2 { background: silver; }
.top3 { background: #cd7f32; }
.search { margin-bottom:10px; padding:5px; width:250px; }
.page-nav button { margin:2px; padding:2px 5px; }
</style>
</head>
<body>
<h1>Osu! Iraq Leaderboard</h1>
<p class="small">Auto-updated via GitHub Actions. Data for country <strong>IQ</strong>.</p>
<p>Last update: <span id="updated">-</span> â€” Source: <span id="source">leaderboard.json</span></p>

<div class="tab-buttons">
<button onclick="showTab('pp')">PP</button>
<button onclick="showTab('accuracy')">Accuracy</button>
<button onclick="showTab('play_count')">Play Count</button>
<button onclick="showTab('ranked_score')">Ranked Score</button>
</div>

<input type="text" id="searchBox" class="search" placeholder="Search username..." oninput="renderCurrentTab()">

<div id="pp" class="tab"></div>
<div id="accuracy" class="tab"></div>
<div id="play_count" class="tab"></div>
<div id="ranked_score" class="tab"></div>

<script>
let leaderboard = [];
let currentTab = 'pp';
let currentPage = 1;

function showTab(tab) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.getElementById(tab).classList.add('active');
  currentTab = tab;
  currentPage = 1;
  renderCurrentTab();
}

function formatNum(n) { return n.toLocaleString(); }

function renderTable(tabId, data) {
  const perPage = 50;
  const totalPages = Math.ceil(data.length / perPage);
  const start = (currentPage-1)*perPage;
  const end = start+perPage;
  const slice = data.slice(start,end);

  let html = `<table><thead><tr><th>#</th><th>Username</th><th>${tabId.replace('_',' ')}</th></tr></thead><tbody>`;
  slice.forEach((p,i) => {
    const rank = start+i+1;
    let cls='';
    if(rank===1) cls='top1';
    else if(rank===2) cls='top2';
    else if(rank===3) cls='top3';
    html += `<tr class="${cls}"><td>${rank}</td>
             <td><img src="${p.avatar_url}" class="avatar"><a href="${p.profile_url}" target="_blank">${p.username}</a></td>
             <td>${tabId==='accuracy'?p[tabId].toFixed(2)+'%':formatNum(p[tabId])}</td></tr>`;
  });
  html += `</tbody></table>`;

  // pagination buttons
  html += '<div class="page-nav">';
  for(let i=1;i<=totalPages;i++){
    html += `<button onclick="currentPage=${i}; renderCurrentTab();">${i}</button>`;
  }
  html += '</div>';

  document.getElementById(tabId).innerHTML = html;
}

function renderCurrentTab() {
  const search = document.getElementById('searchBox').value.toLowerCase();
  const items = leaderboard
    .filter(p => !search || p.username.toLowerCase().includes(search))
    .sort((a,b)=>{
      if(currentTab==='accuracy') return b[currentTab]-a[currentTab];
      return b[currentTab]-a[currentTab];
    });
  renderTable(currentTab, items);
}

async function load() {
  try {
    const res = await fetch('leaderboard.json', {cache:'no-store'});
    const json = await res.json();
    document.getElementById('source').textContent = json.source||'leaderboard.json';
    document.getElementById('updated').textContent = json.updated_at ? new Date(json.updated_at).toLocaleString() : '-';
    leaderboard = json.items||[];
    showTab('pp');
  } catch(err){
    console.error(err);
  }
}

load();
setInterval(load, 3600000); // reload every hour
</script>
</body>
</html>
