<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Osu! Iraq Leaderboard</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body { font-family: Arial,sans-serif; padding:20px; max-width:1000px; margin:auto; }
  table { border-collapse: collapse; width:100%; margin-bottom: 20px; }
  th, td { border:1px solid #ddd; padding:8px; text-align:left; }
  th { background:#f4f4f4; }
  .small { font-size:.9em; color:#666; }
  .gold { background: #ffd700; }
  .silver { background: #c0c0c0; }
  .bronze { background: #cd7f32; }
  .pagination button { margin-right: 5px; padding:5px 10px; cursor:pointer; }
</style>
</head>
<body>
<h1>Osu! Iraq Leaderboard</h1>
<p class="small">Auto-updated via GitHub Actions. Data for country <strong>IQ</strong>.</p>
<p>Last update: <span id="updated">-</span> â€” Source: <span id="source">leaderboard.json</span></p>

<input type="text" id="search" placeholder="Search username..." style="margin-bottom:10px; padding:5px; width:200px;">
<div id="table-container"></div>

<div class="pagination">
  <button onclick="showPage(1)">Page 1</button>
  <button onclick="showPage(2)">Page 2</button>
</div>

<script>
let leaderboardData = [];
const PER_PAGE = 50;

async function load() {
  try {
    const res = await fetch('leaderboard.json', {cache:"no-store"});
    if(!res.ok) throw new Error('Could not fetch leaderboard.json');
    const json = await res.json();

    leaderboardData = json.items || [];
    document.getElementById('source').textContent = json.source || 'leaderboard.json';
    document.getElementById('updated').textContent = json.updated_at ? new Date(json.updated_at).toLocaleString() : '-';
    showPage(1);
  } catch(err) {
    document.getElementById('table-container').innerHTML = `<p>Error: ${err.message}</p>`;
  }
}

function showPage(page) {
  const tbody = leaderboardData.slice((page-1)*PER_PAGE, page*PER_PAGE);
  let html = `<table>
    <thead><tr><th>#</th><th>Username</th><th>PP</th><th>Play Count</th></tr></thead>
    <tbody>`;

  tbody.forEach((it,i)=>{
    const globalRank = (page-1)*PER_PAGE + i + 1;
    let rowClass = '';
    if(page===1){
      if(globalRank===1) rowClass='gold';
      else if(globalRank===2) rowClass='silver';
      else if(globalRank===3) rowClass='bronze';
    }
    html += `<tr class="${rowClass}"><td>${globalRank}</td>
      <td><a href="${it.profile_url}" target="_blank">${it.username}</a></td>
      <td>${it.pp}</td>
      <td>${it.play_count}</td>
    </tr>`;
  });

  html += `</tbody></table>`;
  document.getElementById('table-container').innerHTML = html;
}

document.getElementById('search').addEventListener('input', function(e){
  const query = e.target.value.toLowerCase();
  leaderboardData = leaderboardData.filter(u => u.username.toLowerCase().includes(query));
  showPage(1);
});

load();
</script>
</body>
</html>
